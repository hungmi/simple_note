<h1 class="h2">
  <%= Payment.model_name.human %><%= I18n.t("text.index") %>
  <%= link_to "#paymentAdvanceSearch", class: "d-print-none btn btn-link float-right", data: { toggle: "collapse" } do %>
  	<i class="material-icons">&#xE152;</i>
  <% end %>
</h1>

<div class="w-100 d-print-none mb-4 collapse <%= 'show' if params[:q].present? %>" id="paymentAdvanceSearch">
	<div class="card w-100">
		<div class="card-body">
			<%= render "filter" %>
		</div>
	</div>
</div>
<div class="mt-2 mb-4 text-right <%= 'd-none' unless params[:q].present? %>">
	<%= I18n.t("text.search_result") %>：<%= @q.result(distinct: true).size %>
</div>

<div class="mb-4">
	<table class="table table-sm table-bordered table-responsive-sm">
		<tr>
	    <th></th>
	    <th style="font-size: 16px;">支出</th>
	    <th style="font-size: 16px;">收入</th>
	    <th style="font-size: 16px;">淨額</th>
	  </tr>
		<% Notebook.all.map do |nb| %>
		  <tr>
		    <th style="width: 15px; font-size: 16px;"><%= nb.name %></th>
		    <td>
		    	<table class="table table-sm table-inside">
		    		<% Project.where(id: nb.payments.pluck(:project_id)).each do |project| %>
			    		<tr>
		    				<th style="width: 10px;"><%= project.name %></th>
		    				<td><%= nb.payments.where(project_id: project.id).sum(:total).to_i %></td>
			    		</tr>
		    		<% end %>
		    	</table>
		    </td>
		    <td>
		    	<table class="table table-sm table-inside">
		    		<% Project.where(id: nb.payments.pluck(:project_id)).each do |project| %>
			    		<tr>
		    				<th style="width: 10px;"><%= project.name %></th>
		    				<td><%= nb.payments.where(project_id: project.id).sum(:total).to_i %></td>
			    		</tr>
		    		<% end %>
		    	</table>
		    </td>
		    <td>
		    	<table class="table table-sm table-inside">
		    		<% Project.where(id: nb.payments.pluck(:project_id)).each do |project| %>
			    		<tr>
		    				<th style="width: 10px;"><%= project.name %></th>
		    				<td><%= nb.payments.where(project_id: project.id).sum(:total).to_i %></td>
			    		</tr>
		    		<% end %>
		    	</table>
		    </td>
		  </tr>
		<% end %>
	</table>
</div>

<%== pagy_bootstrap_nav(@pagy) %>
<div class="mb-4">
	<% if not_desktop? %>
		<h6><%= @dates.max %> ~ <%= @dates.min %> | total: <%= @payments.size %></h6>
  	<%= render @payments %>
  <% else %>
  	<%= render partial: "payments_table", locals: { payments: @payments } %>
  <% end %>
</div>
<%== pagy_bootstrap_nav(@pagy) %>

<div class="btn-abs-wrapper">
	<%= link_to new_admin_payment_path, class: "btn btn-success btn-icon--circle" do %>
		<i class="material-icons">&#xE145;</i>
	<% end %>
	<% if false#not_desktop? %>
		<%= link_to "#", class: "btn btn-secondary d-lg-none btn-icon--circle", data: { toggle: "modal", target: "#searchModal" } do %>
	    <i class="material-icons">&#xE8B6;</i>
	  <% end %>
  <% end %>
</div>

<% if false#not_desktop? %>
  <%= render "admin/common/search_modal" %>
<% end %>